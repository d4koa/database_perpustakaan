/*
    Nama database : PERPUSTAKAAN
    Software DBMS : ORACLE APEX
*/

-- Membuat beberepa tabel pada database PERPUSTAKAAN
-- Membuat tabel BUKU
CREATE TABLE BUKU (
    ID_BUKU CHAR(6) CONSTRAINT PK_BUKU PRIMARY KEY,
    JUDUL_BUKU VARCHAR2(255),
    TAHUN_TERBIT CHAR(4),
    ISBN VARCHAR2(45),
    PENGARANG VARCHAR2(100),
    PENERBIT VARCHAR2(50)
)

-- Membuat tabel STAFF
CREATE TABLE STAFF (
    ID_STAFF CHAR(6) CONSTRAINT PK_STAFF PRIMARY KEY,
    NAMA_LENGKAP VARCHAR2(100),
    USERNAME VARCHAR2(50),
    PASSWORD VARCHAR2(50),
    GENDER CHAR(1),
    ALAMAT VARCHAR2(255),
    NO_TELP VARCHAR2(13),
    CREATED_AT date DEFAULT SYSDATE
)

-- Membuat tabel MEMBER
CREATE TABLE MEMBER (
    ID_MEMBER CHAR(7) CONSTRAINT PK_MEMBER PRIMARY KEY,
    NAMA_LENGKAP VARCHAR2(100),
    GENDER CHAR(1),
    ALAMAT VARCHAR2(255),
    NO_TELP VARCHAR2(13),
    CREATED_AT date DEFAULT SYSDATE
)

-- Membuat tabel PENGUNJUNG
CREATE TABLE PENGUNJUNG (
    ID_PENGUNJUNG CHAR(6) CONSTRAINT PK_PENGUNJUNG PRIMARY KEY,
    ID_MEMBER CHAR(7) REFERENCES MEMBER(ID_MEMBER),
    TGL_KUNJUNGAN date
)

-- Membuat tabel PEMINJAMAN
CREATE TABLE PEMINJAMAN (
    ID_PINJAM CHAR(6) CONSTRAINT PK_PINJAM PRIMARY KEY,
    ID_BUKU CHAR(5) REFERENCES BUKU(id_buku),
    TGL_PINJAM date,
    TGL_KEMBALI date,
    ID_STAFF CHAR(6) REFERENCES STAFF(id_staff),
    ID_MEMBER CHAR(7) REFERENCES MEMBER(id_member)
)

-- Membuat tabel PENGEMBALIAN
CREATE TABLE PENGEMBALIAN (
    ID_KEMBALI CHAR(6) CONSTRAINT PK_KEMBALI PRIMARY KEY,
    TGL_PENGEMBALIAN date,
    ID_PINJAM CHAR(6) REFERENCES PEMINJAMAN(id_pinjam),
    DENDA number(6),
    ID_STAFF CHAR(6) REFERENCES STAFF(id_staff),
    ID_MEMBER CHAR(7) REFERENCES MEMBER(id_member)
)

-- Membuat beberapa view dengan beberapa kondisi
-- Membuat view V_PEMINJAMAN_BUKU -> pinjam buku
CREATE VIEW V_PEMINJAMAN_BUKU AS
SELECT  A.ID_PINJAM KODE_PINJAM,
        B.JUDUL_BUKU BUKU, 
        B.ID_BUKU KODE_BUKU, 
        C.NAMA_LENGKAP PEMINJAM, 
        C.ID_MEMBER KODE_MEMBER, 
        D.NAMA_LENGKAP PEMBERI,
        D.ID_STAFF KODE_PEMBER, 
        A.TGL_PINJAM, 
        A.TGL_KEMBALI
FROM PEMINJAMAN A
JOIN BUKU B ON B.ID_BUKU = A.ID_BUKU
JOIN MEMBER C ON C.ID_MEMBER = A.ID_MEMBER
JOIN STAFF D ON D.ID_STAFF = A.ID_STAFF

-- Membuat view V_PENGEMBALIAN_BUKU -> pengembalian buku 
CREATE VIEW V_PENGEMBALIAN_BUKU AS
SELECT  A.ID_KEMBALI KODE_KEMBALI, 
        B.BUKU, 
        B.KODE_BUKU,
        C.NAMA_LENGKAP PEMINJAM, 
        C.ID_MEMBER KODE_PEMINJAM,
        D.NAMA_LENGKAP PENERIMA, 
        D.ID_STAFF KODE_PENERIMA,
        A.TGL_PENGEMBALIAN, 
        A.DENDA
FROM PENGEMBALIAN A
JOIN V_PEMINJAMAN_BUKU B ON B.KODE_PINJAM = A.ID_PINJAM
JOIN MEMBER C ON C.ID_MEMBER = A.ID_MEMBER
JOIN STAFF D ON D.ID_STAFF = A.ID_STAFF

-- Membuat view V_REKAP_PENGUNJUNG -> rekap pengunjung
CREATE VIEW V_REKAP_PENGUNJUNG AS
SELECT  A.ID_PENGUNJUNG KODE_PENGUNJUNG, 
        B.ID_MEMBER KODE_MEMBER, 
        A.TGL_KUNJUNGAN
FROM PENGUNJUNG A
JOIN MEMBER B ON B.ID_MEMBER = A.ID_MEMBER
